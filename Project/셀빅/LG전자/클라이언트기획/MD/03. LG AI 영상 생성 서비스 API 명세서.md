# LG AI 영상 생성 웹 서비스 - API 명세서

## 📋 개요
본 문서는 LG AI 영상 생성 웹 서비스의 클라이언트-서버 간 통신을 위한 API 명세를 정리한 문서입니다.

### 🔧 기본 정보
- **Base URL**: `https://api.lg-video-generator.com/v1`
- **인증 방식**: Mac Address 기반 사용자 식별
- **데이터 형식**: JSON
- **문자 인코딩**: UTF-8

---

## 🏗️ API 카테고리

### 1. 사용자 관리 API
### 2. 콘텐츠 주제 관리 API  
### 3. 영상 생성 API
### 4. 영상 재생 API
### 5. 영상 목록 관리 API
### 6. 외부 변수 API
### 7. 파일 업로드 API
### 8. 시스템 상태 API

---

## 👤 1. 사용자 관리 API

### 1.1 사용자 식별
**Mac Address 기반 자동 사용자 생성/인증**

```http
POST /users/identify
```

**Request Body**
```json
{
  "macAddress": "AA:BB:CC:DD:EE:FF",
  "deviceInfo": {
    "userAgent": "Mozilla/5.0...",
    "screenResolution": "1920x1080",
    "platform": "desktop"
  }
}
```

**Response**
```json
{
  "success": true,
  "data": {
    "userId": "user_abc123",
    "sessionToken": "eyJhbGciOiJIUzI1NiIs...",
    "isNewUser": false,
    "profile": {
      "totalVideos": 15,
      "favoriteTopics": ["meditation", "visual_art"],
      "lastAccess": "2025-10-13T14:30:00Z"
    }
  }
}
```

---

## 🎨 2. 콘텐츠 주제 관리 API

### 2.1 콘텐츠 주제 목록 조회
**10개 콘텐츠 주제와 상세 정보 조회**

```http
GET /topics
```

**Response**
```json
{
  "success": true,
  "data": {
    "topics": [
      {
        "id": "meditation",
        "name": "명상",
        "description": "휴식을 취하면서 감상할 수 있는 힐링 콘텐츠",
        "icon": "🧘",
        "estimatedTime": "5-10분",
        "clipCount": 1,
        "externalVariables": [],
        "themes": ["nature", "zen", "peaceful"],
        "isActive": true
      },
      {
        "id": "visual_art",
        "name": "비주얼아트", 
        "description": "운동, 공부 등 특정 테마에 맞춘 음악과 영상의 조화",
        "icon": "🎨",
        "estimatedTime": "15-20분",
        "clipCount": 16,
        "externalVariables": ["timeOfDay", "season"],
        "themes": ["exercise", "study", "yoga", "walk", "travel", "reading", "driving"],
        "isActive": true
      }
    ]
  }
}
```

### 2.2 특정 주제 상세 정보 조회
```http
GET /topics/{topicId}
```

**Response**
```json
{
  "success": true,
  "data": {
    "topic": {
      "id": "visual_art",
      "name": "비주얼아트",
      "description": "운동, 공부 등 특정 테마에 맞춘 음악과 영상의 조화",
      "themes": ["exercise", "study", "yoga", "walk", "travel", "reading", "driving"],
      "externalVariables": [
        {
          "name": "timeOfDay",
          "type": "enum",
          "values": ["morning", "day", "evening", "night"],
          "autoDetect": true,
          "source": "system_time"
        },
        {
          "name": "season", 
          "type": "enum",
          "values": ["spring", "summer", "autumn", "winter"],
          "autoDetect": true,
          "source": "date_api"
        }
      ],
      "fileUpload": false,
      "settings": {
        "maxClips": 16,
        "duration": 30,
        "format": "mp4",
        "resolution": "1920x1080"
      }
    }
  }
}
```

---

## 🎬 3. 영상 생성 API

### 3.1 영상 생성 요청
**주제별 설정과 함께 영상 생성 요청**

```http
POST /videos/generate
```

**Request Body (비주얼아트 예시)**
```json
{
  "userId": "user_abc123",
  "topic": "visual_art",
  "settings": {
    "theme": "exercise",
    "additionalOptions": {
      "intensity": "high",
      "musicStyle": "upbeat"
    }
  },
  "files": [],
  "metadata": {
    "clientTimestamp": "2025-10-13T14:30:00Z",
    "clientTimeZone": "Asia/Seoul"
  }
}
```

**Request Body (아바타 예시)**
```json
{
  "userId": "user_abc123", 
  "topic": "avatar",
  "settings": {
    "theme": "exercise",
    "style": "3d_character"
  },
  "files": [
    {
      "type": "profile_image",
      "fileId": "file_xyz789"
    }
  ]
}
```

**Response**
```json
{
  "success": true,
  "data": {
    "jobId": "job_def456",
    "videoId": "video_ghi789",
    "status": "queued",
    "estimatedTime": "15-20분",
    "queuePosition": 3,
    "totalInQueue": 8,
    "settings": {
      "topic": "visual_art",
      "theme": "exercise", 
      "clipCount": 16
    },
    "createdAt": "2025-10-13T14:30:00Z"
  }
}
```

> UI 연결: 요청이 성공하면 ‘생성 요청 완료 팝업’(Modal)을 즉시 표시합니다. 이후 진행 상황은 WebSocket(권장) 또는 상태 조회 API로 확인합니다.

### 3.2 생성 상태 조회
**영상 생성 진행 상황 확인**

```http
GET /videos/generate/{jobId}/status
```

**Response**
```json
{
  "success": true,
  "data": {
    "jobId": "job_def456",
    "videoId": "video_ghi789", 
    "status": "processing",
    "progress": 65,
    "currentStep": "rendering",
    "queuePosition": 0,
    "estimatedTimeRemaining": "7분",
    "steps": [
      {"name": "preprocessing", "status": "completed", "duration": "2분"},
      {"name": "ai_generation", "status": "completed", "duration": "8분"},
      {"name": "rendering", "status": "in_progress", "progress": 65},
      {"name": "optimization", "status": "pending"}
    ],
    "updatedAt": "2025-10-13T14:45:00Z"
  }
}
```

> UI 연결: ‘생성 진행 상황 팝업’(Modal)은 progress/queuePosition만 간단히 표시합니다. 상세 단계(steps)는 UI에 노출하지 않습니다.

### 3.3 생성 완료 알림
**WebSocket을 통한 실시간 알림**

```json
{
  "type": "generation_completed",
  "data": {
    "jobId": "job_def456",
    "videoId": "video_ghi789",
    "status": "completed",
    "clipCount": 16,
    "totalDuration": 30,
    "fileSize": "8.5MB",
    "thumbnail": "https://cdn.lg-video.com/thumbnails/video_ghi789.jpg",
    "completedAt": "2025-10-13T14:50:00Z"
  }
}
```

> UI 연결: 수신 즉시 ‘영상 완료 알림 팝업’(Modal)을 표시하고 썸네일/제목/길이만 최소로 보여줍니다. [지금 보기] 클릭 시 재생 페이지로 이동합니다.

---

## ▶️ 4. 영상 재생 API

### 4.1 영상 스트리밍 URL 조회
**재생을 위한 스트리밍 URL 및 메타데이터 조회**

```http
GET /videos/{videoId}/stream
```

**Query Parameters**
```
?quality=hd&timeOfDay=day&season=autumn
```

**Response**
```json
{
  "success": true,
  "data": {
    "videoId": "video_ghi789",
    "streamUrl": "https://stream.lg-video.com/hls/video_ghi789/playlist.m3u8",
    "alternativeFormats": {
      "mp4": "https://cdn.lg-video.com/mp4/video_ghi789.mp4",
      "webm": "https://cdn.lg-video.com/webm/video_ghi789.webm"
    },
    "currentClip": {
      "index": 5,
      "variables": {
        "timeOfDay": "day",
        "season": "autumn"
      },
      "duration": 30,
      "resolution": "1920x1080"
    },
    "metadata": {
      "title": "비주얼아트 - 운동",
      "duration": 30,
      "format": "mp4",
      "codec": "h264",
      "bitrate": "2000kbps",
      "createdAt": "2025-10-13T14:50:00Z"
    }
  }
}
```

### 4.2 영상 상세 정보 조회
```http
GET /videos/{videoId}
```

**Response**
```json
{
  "success": true,
  "data": {
    "video": {
      "id": "video_ghi789",
      "title": "비주얼아트 - 운동",
      "topic": "visual_art",
      "theme": "exercise",
      "creatorId": "user_abc123",
      "isPublic": true,
      "viewCount": 42,
      "duration": 30,
      "clipCount": 16,
      "fileSize": "8.5MB",
      "resolution": "1920x1080",
      "thumbnail": "https://cdn.lg-video.com/thumbnails/video_ghi789.jpg",
      "createdAt": "2025-10-13T14:50:00Z",
      "settings": {
        "theme": "exercise",
        "externalVariables": ["timeOfDay", "season"]
      }
    }
  }
}
```

### 4.3 조회수 증가
```http
POST /videos/{videoId}/view
```

**Request Body**
```json
{
  "userId": "user_abc123",
  "sessionId": "session_123",
  "watchTime": 25,
  "quality": "hd"
}
```

---

## 📋 5. 영상 목록 관리 API

### 5.1 내 영상 목록 조회
```http
GET /users/{userId}/videos
```

**Query Parameters**
```
?page=1&limit=20&topic=visual_art&sortBy=createdAt&order=desc
```

**Response**
```json
{
  "success": true,
  "data": {
    "videos": [
      {
        "id": "video_ghi789",
        "title": "비주얼아트 - 운동",
        "topic": "visual_art",
        "theme": "exercise",
        "thumbnail": "https://cdn.lg-video.com/thumbnails/video_ghi789.jpg",
        "duration": 30,
        "viewCount": 42,
        "isPublic": true,
        "createdAt": "2025-10-13T14:50:00Z"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 15,
      "totalPages": 1
    }
  }
}
```

### 5.2 공개 영상 목록 조회 (다른 유저 영상)
```http
GET /videos/public
```

**Query Parameters**
```
?page=1&limit=24&topic=visual_art
```

**Response**
```json
{
  "success": true,
  "data": {
    "videos": [
      {
        "id": "video_public1",
        "topic": "visual_art",
        "theme": "exercise",
        "thumbnail": "https://cdn.lg-video.com/thumbnails/video_public1.jpg"
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 24,
      "total": 246,
      "totalPages": 11
    }
  }
}
```

> UI 연결: 갤러리 카드에는 썸네일과 콘텐츠 주제만 노출합니다(제목/조회수/시간 등 메타데이터 미노출). 정렬/트렌딩/기간 필터는 현재 UI에서 사용하지 않습니다.

### 5.3 영상 검색
```http
GET /videos/search
```

**Query Parameters**
```
?q=운동&topic=visual_art&page=1&limit=10
```

**Response**
```json
{
  "success": true,
  "data": {
    "videos": [
      {
        "id": "video_search1",
        "title": "비주얼아트 - 운동",
        "topic": "visual_art",
        "theme": "exercise",
        "relevanceScore": 0.95,
        "highlights": ["운동", "에너지"],
        "thumbnail": "https://cdn.lg-video.com/thumbnails/video_search1.jpg"
      }
    ],
    "searchInfo": {
      "query": "운동",
      "totalResults": 25,
      "searchTime": "0.05초"
    }
  }
}
```
> 비고: 기본 갤러리 UI에는 검색 입력이 없을 수 있으나, 별도 검색 화면/기능에서 재사용 가능합니다.

### 5.4 즐겨찾기 저장/해제 (저장 버튼)
```http
POST /users/{userId}/favorites
DELETE /users/{userId}/favorites/{videoId}
GET /users/{userId}/favorites
```

**POST Request Body**
```json
{ "videoId": "video_ghi789" }
```

**POST Response**
```json
{ "success": true, "data": { "videoId": "video_ghi789", "favoritedAt": "2025-10-13T15:00:00Z" } }
```

### 5.5 콘텐츠 신고 (신고 버튼)
```http
POST /videos/{videoId}/report
```

**Request Body**
```json
{
  "userId": "user_abc123",
  "reason": "inappropriate_content",
  "message": "저작권 침해 의심"
}
```

**Response**
```json
{ "success": true, "data": { "reportId": "report_123", "receivedAt": "2025-10-13T15:02:00Z" } }
```

---

## 🌐 6. 외부 변수 API

### 6.1 현재 외부 변수 조회
**IoT 센서 및 외부 API 연동으로 실시간 환경 정보 조회**

```http
GET /external-variables/current
```

**Query Parameters**
```
?userId=user_abc123&location=true&weather=true&sensors=true
```

**Response**
```json
{
  "success": true,
  "data": {
    "timestamp": "2025-10-13T14:30:00Z",
    "location": {
      "latitude": 37.5665,
      "longitude": 126.9780,
      "address": "서울특별시 중구",
      "indoor": true
    },
    "timeOfDay": {
      "current": "day",
      "sunrise": "06:45",
      "sunset": "18:30",
      "source": "system_time"
    },
    "season": {
      "current": "autumn",
      "source": "date_calculation"
    },
    "weather": {
      "condition": "clear",
      "temperature": 22,
      "humidity": 65,
      "source": "openweather_api",
      "lastUpdated": "2025-10-13T14:25:00Z"
    },
    "sensors": {
      "humidity": {
        "value": "적절",
        "percentage": 65,
        "source": "iot_sensor_001",
        "lastUpdated": "2025-10-13T14:29:00Z"
      },
      "lightLevel": {
        "value": 750,
        "category": "bright",
        "source": "iot_sensor_002"
      }
    }
  }
}
```

### 6.2 테스트용 외부 변수 설정
**개발/테스트 환경에서 외부 변수 수동 조작**

```http
POST /external-variables/test-override
```

**Request Body**
```json
{
  "userId": "user_abc123",
  "overrides": {
    "timeOfDay": "night",
    "season": "winter",
    "weather": "snow",
    "humidity": "건조"
  },
  "duration": 300,
  "testMode": true
}
```

**Response**
```json
{
  "success": true,
  "data": {
    "overrideId": "override_123",
    "activeOverrides": {
      "timeOfDay": "night",
      "season": "winter", 
      "weather": "snow",
      "humidity": "건조"
    },
    "expiresAt": "2025-10-13T14:35:00Z",
    "testMode": true
  }
}
```

### 6.4 테스트용 외부 변수 해제
```http
DELETE /external-variables/test-override/{overrideId}
```

**Response**
```json
{ "success": true, "data": { "overrideId": "override_123", "disabledAt": "2025-10-13T14:36:00Z" } }
```

### 6.3 외부 변수 히스토리 조회
```http
GET /external-variables/history
```

**Query Parameters**
```
?userId=user_abc123&timeRange=24h&variables=timeOfDay,weather
```

**Response**
```json
{
  "success": true,
  "data": {
    "history": [
      {
        "timestamp": "2025-10-13T14:00:00Z",
        "timeOfDay": "day",
        "weather": "clear",
        "season": "autumn"
      },
      {
        "timestamp": "2025-10-13T13:00:00Z", 
        "timeOfDay": "day",
        "weather": "cloudy",
        "season": "autumn"
      }
    ]
  }
}
```

---

## 📁 7. 파일 업로드 API

### 7.1 파일 업로드 (아바타, 기념앨범, 음악감상)
```http
POST /files/upload
```

**Request (Multipart Form Data)**
```
Content-Type: multipart/form-data

userId: user_abc123
topic: avatar
fileType: profile_image
file: [binary data]
```

**Response**
```json
{
  "success": true,
  "data": {
    "fileId": "file_xyz789",
    "originalName": "profile.jpg",
    "fileSize": "2.1MB",
    "mimeType": "image/jpeg",
    "uploadedAt": "2025-10-13T14:30:00Z",
    "processingStatus": "completed",
    "metadata": {
      "width": 1920,
      "height": 1080,
      "format": "JPEG",
      "faces": 1,
      "isValid": true
    },
    "cdnUrl": "https://cdn.lg-video.com/uploads/file_xyz789.jpg"
  }
}
```

### 7.2 파일 상태 조회
```http
GET /files/{fileId}
```

**Response**
```json
{
  "success": true,
  "data": {
    "fileId": "file_xyz789",
    "status": "processed",
    "originalName": "profile.jpg",
    "fileSize": "2.1MB",
    "mimeType": "image/jpeg",
    "cdnUrl": "https://cdn.lg-video.com/uploads/file_xyz789.jpg",
    "processingResult": {
      "faceDetection": {
        "faces": 1,
        "confidence": 0.95,
        "boundingBox": {
          "x": 100, "y": 50,
          "width": 200, "height": 250
        }
      },
      "qualityCheck": {
        "resolution": "acceptable",
        "brightness": "good",
        "sharpness": "good"
      }
    }
  }
}
```

---

## 🔧 8. 시스템 상태 API

### 8.1 서버 상태 조회
```http
GET /system/status
```

**Response**
```json
{
  "success": true,
  "data": {
    "server": {
      "status": "healthy",
      "version": "1.2.3",
      "uptime": "7d 12h 30m",
      "lastRestart": "2025-10-06T09:00:00Z"
    },
    "queue": {
      "totalJobs": 12,
      "activeJobs": 3,
      "waitingJobs": 9,
      "averageProcessingTime": "12분",
      "estimatedWaitTime": "8분"
    },
    "aiService": {
      "status": "operational",
      "responseTime": "2.3s",
      "successRate": 98.5,
      "lastHealthCheck": "2025-10-13T14:28:00Z"
    },
    "iot": {
      "connectedSensors": 15,
      "activeSensors": 14,
      "lastDataReceived": "2025-10-13T14:29:30Z"
    },
    "cdn": {
      "status": "operational",
      "cacheHitRate": 95.2,
      "bandwidth": "1.2 Gbps"
    }
  }
}
```

### 8.2 시스템 통계 조회
```http
GET /system/stats
```

**Response**
```json
{
  "success": true,
  "data": {
    "usage": {
      "totalUsers": 1234,
      "activeUsers": 567,
      "totalVideos": 5678,
      "videosToday": 89,
      "totalViews": 12345,
      "viewsToday": 456
    },
    "performance": {
      "averageGenerationTime": "12분",
      "successRate": 98.8,
      "systemLoad": 65.2,
      "diskUsage": 78.5,
      "memoryUsage": 45.3
    },
    "topTopics": [
      {"topic": "meditation", "count": 234},
      {"topic": "visual_art", "count": 189},
      {"topic": "pet", "count": 156}
    ]
  }
}
```

---

## 🔗 WebSocket API

### 실시간 알림 및 상태 업데이트

**Connection**
```
wss://api.lg-video-generator.com/v1/ws?userId=user_abc123&sessionToken=eyJhbGci...
```

**메시지 유형**

#### 1. 영상 생성 진행 상황
```json
{
  "type": "generation_progress",
  "data": {
    "jobId": "job_def456",
    "progress": 45,
    "currentStep": "ai_generation",
    "estimatedTimeRemaining": "8분"
  }
}
```
> UI 연결: ‘생성 진행 상황 팝업’에 progress만 바인딩합니다.

#### 2. 영상 생성 완료
```json
{
  "type": "generation_completed",
  "data": {
    "jobId": "job_def456",
    "videoId": "video_ghi789",
    "thumbnailUrl": "https://cdn.lg-video.com/thumbnails/video_ghi789.jpg"
  }
}
```
> UI 연결: ‘영상 완료 알림 팝업’의 썸네일/바로가기 버튼에 사용합니다.

#### 3. 외부 변수 변화 알림
```json
{
  "type": "external_variables_changed",
  "data": {
    "changes": {
      "timeOfDay": {"from": "day", "to": "evening"},
      "weather": {"from": "clear", "to": "cloudy"}
    },
    "timestamp": "2025-10-13T18:00:00Z"
  }
}
```

#### 4. 시스템 알림
```json
{
  "type": "system_notification",
  "data": {
    "level": "info",
    "message": "시스템 점검이 5분 후 시작됩니다.",
    "actionRequired": false
  }
}
```

---

## 📝 Error Handling

### HTTP 상태 코드
- `200`: 성공
- `201`: 생성 성공  
- `400`: 잘못된 요청
- `401`: 인증 실패
- `403`: 권한 없음
- `404`: 리소스 없음
- `409`: 충돌 (중복 요청 등)
- `429`: 요청 한도 초과
- `500`: 서버 내부 오류
- `503`: 서비스 일시 불가

### 에러 응답 형식
```json
{
  "success": false,
  "error": {
    "code": "INVALID_TOPIC",
    "message": "지원하지 않는 콘텐츠 주제입니다.",
    "details": {
      "providedTopic": "invalid_topic",
      "availableTopics": ["meditation", "visual_art", "pet", ...]
    },
    "timestamp": "2025-10-13T14:30:00Z",
    "requestId": "req_abc123"
  }
}
```

### 주요 에러 코드
- `USER_NOT_FOUND`: 사용자를 찾을 수 없음
- `INVALID_TOPIC`: 유효하지 않은 콘텐츠 주제
- `FILE_TOO_LARGE`: 파일 크기 제한 초과
- `GENERATION_FAILED`: 영상 생성 실패
- `QUEUE_FULL`: 생성 대기열 포화
- `EXTERNAL_API_ERROR`: 외부 API 연동 오류
- `IOT_SENSOR_OFFLINE`: IoT 센서 연결 실패

---

## 🔒 보안 및 인증

### Mac Address 기반 인증
- 클라이언트 Mac Address를 사용한 사용자 식별
- 세션 토큰 발급 및 관리
- 개인정보 최소화 정책

### API 보안
- HTTPS 강제 사용
- Request/Response 암호화
- Rate Limiting (분당 100 요청)
- Input Validation 및 Sanitization

### 데이터 보호
- 업로드 파일 자동 스캔 및 검증
- 개인 영상 데이터 암호화 저장
- 자동 백업 및 복구 시스템

---

## 📊 API 성능 및 제한사항

### Rate Limiting
- **일반 API**: 분당 100 요청
- **파일 업로드**: 시간당 10 요청
- **영상 생성**: 일일 20 요청
- **스트리밍**: 무제한

### 파일 제한사항
- **이미지**: 최대 10MB, JPG/PNG
- **음악**: 최대 50MB, MP3
- **지원 해상도**: 최소 720p, 최대 4K

### 시스템 제한
- **동시 생성**: 최대 50개 작업
- **영상 저장**: 사용자당 최대 100개
- **캐시 유효기간**: 24시간

---

*이 API 명세서는 LG AI 영상 생성 웹 서비스의 모든 클라이언트-서버 통신을 다루며, 실제 구현 시 세부사항은 조정될 수 있습니다.*