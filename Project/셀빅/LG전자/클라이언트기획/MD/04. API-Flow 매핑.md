# API ↔ 플로우 매핑

본 문서는 페이지 플로우(`LG AI 영상 생성 웹페이지 플로우.md`)와 화면 스펙(`LG AI 영상 생성 웹 서비스 화면 Wireframe.md`)을 기준으로, 각 단계에서 어떤 API가 호출되는지 요약합니다.

---

## 0) 공통/초기화
- 사용자 식별
  - POST /users/identify
  - 타이밍: 앱 최초 진입 시 1회 (세션 유지)

---

## 1) 메인 페이지 (Landing)
- 주제 목록 표시(옵션)
  - GET /topics
  - 메모: 메인은 고정 주제 카드로도 구성 가능 – 캐시 사용 권장

---

## 2) 주제별 설정 페이지 (예: 비주얼아트/아바타 등)
- 주제 상세 정보(옵션)
  - GET /topics/{topicId}
- 파일 업로드(필요 시)
  - POST /files/upload → GET /files/{fileId}

---

## 3) 생성 요청 확인 → 생성 요청
- 영상 생성 요청
  - POST /videos/generate
  - 응답 수신 후: ‘생성 요청 완료 팝업’ 표시
- 진행 상황 확인(선택)
  - WebSocket generation_progress or
  - GET /videos/generate/{jobId}/status
  - UI: ‘생성 진행 상황 팝업’에서 progress/queuePosition만 노출

---

## 4) 생성 완료 알림
- WebSocket generation_completed
  - 수신 즉시: ‘영상 완료 알림 팝업’ 표시 (썸네일/제목/길이 최소 정보)

---

## 5) 영상 재생 페이지
- 스트리밍 URL 조회
  - GET /videos/{videoId}/stream
- 영상 상세 정보(상세 패널)
  - GET /videos/{videoId}
- 조회수 증가(옵션)
  - POST /videos/{videoId}/view
- 외부 변수 현재값(패널)
  - GET /external-variables/current
- 테스트용 외부 변수 설정/해제(개발 모드)
  - POST /external-variables/test-override
  - DELETE /external-variables/test-override/{overrideId}

---

## 6) 내 영상 목록
- GET /users/{userId}/videos

---

## 7) 다른 유저 영상 목록 (갤러리)
- 공개 영상 목록(갤러리)
  - GET /videos/public?page=1&limit=24&topic={topic}
  - UI: 카드에 썸네일 + 콘텐츠 주제만 표시
- (선택) 검색/정렬은 현재 UI에 미노출 – 별도 화면에서 GET /videos/search 재사용 가능

---

## 8) 영상 상세 정보 페이지 (전체화면 + 좌측 패널)
- 영상 상세/메타
  - GET /videos/{videoId}
- 즐겨찾기(저장)/신고 버튼
  - POST /users/{userId}/favorites / DELETE .../favorites/{videoId}
  - POST /videos/{videoId}/report
- 외부 변수 패널
  - GET /external-variables/current
  - (개발 모드) POST/DELETE test-override

---

## 이벤트 흐름과 UI 연결 요약
- POST /videos/generate 성공 → 생성 요청 완료 팝업
- generation_progress (WS) → 생성 진행 상황 팝업(progress만)
- generation_completed (WS) → 영상 완료 알림 팝업 → [지금 보기]시 /videos/{id}/stream

---

비고
- 모달 UI는 최소 정보만 노출하도록 제한되었습니다. 자세한 상태/통계는 API로 제공되더라도 현재 UI에는 표시하지 않습니다.
